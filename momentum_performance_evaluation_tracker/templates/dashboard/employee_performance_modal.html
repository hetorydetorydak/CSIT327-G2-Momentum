<!-- Performance Details Modal -->
<div id="performanceModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <button class="modal-close" id="closePerformanceModal">×</button>
        <h2 id="performanceModalTitle">
            {% if employee_data %}
            Performance Details - {{ employee_data.employee_name }}
            {% else %}
            Performance Details
            {% endif %}
        </h2>
        <div class="modal-body" id="performanceModalBody">
            {% if employee_data %}
            <!-- Performance Content when data is available -->
            <div class="employee-basic-info">
                <div class="info-item">
                    <strong>Position:</strong> {{ employee_data.position|default:"Not specified" }}
                </div>
                <div class="info-item">
                    <strong>Department:</strong> {{ employee_data.department|default:"Not specified" }}
                </div>
            </div>

            <div class="performance-metrics-grid">
                <div class="metric-card overall-performance">
                    <h3>Overall Performance</h3>
                    <div
                        class="metric-value large {% if employee_data.attendance_rate >= 85 %}good{% else %}poor{% endif %}">
                        {{ employee_data.performance_score }}%
                    </div>
                </div>
                <div class="metric-card">
                    <h3>Attendance Rate</h3>
                    <div class="metric-value {% if employee_data.attendance_rate >= 85 %}good{% else %}poor{% endif %}">
                        {{ employee_data.attendance_rate }}%
                    </div>
                </div>
                <div class="metric-card">
                    <h3>Compliance Rate</h3>
                    <div class="metric-value {% if employee_data.compliance_rate >= 80 %}good{% else %}poor{% endif %}">
                        {{ employee_data.compliance_rate }}%
                    </div>
                </div>
                <div class="metric-card">
                    <h3>Backlog Items</h3>
                    <div class="metric-value {% if employee_data.backlog_count <= 2 %}good{% else %}poor{% endif %}">
                        {{ employee_data.backlog_count }}
                    </div>
                </div>
            </div>

            {% if employee_data.pending_tasks %}
            <div class="tasks-section pending-tasks-section">
                <h3>Pending Tasks</h3>
                <div class="tasks-list">
                    {% for task in employee_data.pending_tasks %}
                    <div class="task-item {{ task.priority|lower }} pending-task" data-task-id="{{ task.id }}">
                        <div class="task-content">
                            <span class="task-desc">{{ task.description }}</span>
                            <span class="task-due">Due: {{ task.due_date }} | Status: {{ task.status }}</span>
                            <span class="task-priority">{{ task.priority }}</span>
                            {% if task.has_file %}
                            <div class="task-file-info">
                                <small>
                                    <i class="fas fa-paperclip"></i> {{ task.file_name }}
                                </small>
                            </div>
                            {% endif %}
                        </div>
                        <div class="task-actions">
                            {% if task.has_file %}
                            <button class="btn-file-view" onclick="viewTaskFile({{ task.id }})">
                                <i class="fas fa-eye"></i> View File
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="no-data">No pending tasks found.</div>
            {% endif %}

            <!-- Completed Tasks Section -->
            {% if employee_data.completed_tasks %}
            <div class="tasks-section completed-tasks-section">
                <h3>Completed & Accepted Tasks</h3>
                <div class="tasks-list">
                    {% for task in employee_data.completed_tasks %}
                    <div class="task-item {{ task.priority|lower }} 
            {% if task.status == 'Accepted' %}accepted-task{% else %}completed-task{% endif %}"
                        data-task-id="{{ task.id }}">
                        <div class="task-content">
                            <div class="task-header">
                                <span class="task-desc">{{ task.description }}</span>
                                <span class="task-status-badge 
                        {% if task.review_status == 'Pending Review' %}pending-review
                        {% elif task.review_status == 'Accepted' %}accepted
                        {% elif task.review_status == 'Rejected' %}rejected
                        {% endif %}">
                                    {% if task.status == 'Accepted' %}
                                    <i class="fas fa-check-circle"></i> Accepted
                                    {% elif task.review_status == 'Pending Review' %}
                                    {{ task.review_status }}
                                    {% elif task.review_status == 'Rejected' %}
                                    <i class="fas fa-times-circle"></i> Rejected
                                    {% else %}
                                    Completed
                                    {% endif %}
                                </span>
                            </div>
                            <div class="task-details">
                                <span class="task-due">Due: {{ task.due_date }}</span>
                                {% if task.completed_date %}
                                <span class="task-completed">Completed: {{ task.completed_date }}</span>
                                {% endif %}
                                <span class="task-priority">{{ task.priority }}</span>
                            </div>
                            {% if task.has_file %}
                            <div class="task-file-info">
                                <small>
                                    <i class="fas fa-paperclip"></i> {{ task.file_name }}
                                    <br>
                                    <small>Uploaded: {{ task.uploaded_at }}</small>
                                </small>
                            </div>
                            {% endif %}

                            {% if task.review_status == 'Accepted' or task.review_status == 'Rejected' %}
                            <div class="review-info">
                                <small>
                                    <strong>Reviewed by:</strong> {{ task.reviewed_by }}<br>
                                    <strong>Reviewed at:</strong> {{ task.reviewed_at }}<br>
                                    {% if task.review_notes %}
                                    <strong>Notes:</strong> {{ task.review_notes }}
                                    {% endif %}
                                </small>
                            </div>
                            {% endif %}
                        </div>
                        <div class="task-actions">
                            {% if task.has_file %}
                            <button class="btn-file-view" onclick="viewTaskFile({{ task.id }})">
                                <i class="fas fa-eye"></i> View File
                            </button>
                            {% else %}
                            <span class="no-file">No file uploaded</span>
                            {% endif %}

                            {% if task.review_status == 'Pending Review' %}
                            <div class="review-buttons">
                                <button class="btn-accept" onclick="reviewTask({{ task.id }}, 'accept')">
                                    <i class="fas fa-check"></i> Accept
                                </button>
                                <button class="btn-reject" onclick="reviewTask({{ task.id }}, 'reject')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="no-data">No completed or accepted tasks found.</div>
            {% endif %}

            {% if employee_data.pending_tasks|length >= 10 or employee_data.completed_tasks|length >= 10 %}
            <div class="view-all-tasks">
                <button class="btn-view-all" onclick="loadAllTasks({{ employee_id }})">
                    View All Tasks
                </button>
            </div>
            {% endif %}


            {% if employee_data.attendance_history %}
            <div class="attendance-section">
                <h3>Recent Attendance</h3>
                <div class="attendance-list">
                    {% for attendance in employee_data.attendance_history %}
                    <div class="attendance-item {{ attendance.status|lower }}">
                        <span class="attendance-date">{{ attendance.date }}</span>
                        <span class="attendance-status">{{ attendance.status }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            <div class="task-assignment-section">
                <h3>Assign New Task</h3>
                <form id="assignTaskForm" class="task-assignment-form">
                    <input type="hidden" id="assignEmployeeId" value="{{ employee_id }}">

                    <div class="form-group">
                        <label for="taskDescription">Task Description</label>
                        <textarea id="taskDescription" name="task_description" required
                            placeholder="Enter task description..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="dueDate">Due Date</label>
                        <input type="date" id="dueDate" name="due_date" required>
                    </div>

                    <div class="form-group">
                        <label for="taskPriority">Priority</label>
                        <select id="taskPriority" name="priority">
                            <option value="Low">Low</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="High">High</option>
                            <option value="Critical">Critical</option>
                        </select>
                    </div>

                    <button type="submit" class="btn-primary">Assign Task</button>
                </form>
            </div>

            {% if employee_data %}
            <div class="remove-team-section">
                <button class="remove-from-team-btn" onclick="removeFromTeam({{ employee_id }})">
                    Remove From Team
                </button>
            </div>
            {% endif %}

            {% else %}
            <div class="loading">Select an employee to view performance details...</div>
            {% endif %}
        </div>
    </div>

    <div id="reviewNotesModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <button class="modal-close" id="closeReviewModal">×</button>
            <h2 id="reviewModalTitle">Review Task</h2>
            <div class="modal-body">
                <form id="reviewNotesForm">
                    <input type="hidden" id="reviewTaskId">
                    <input type="hidden" id="reviewAction">

                    <div class="form-group">
                        <label for="reviewNotesTextarea" id="reviewNotesLabel">
                            Notes (optional)
                        </label>
                        <textarea id="reviewNotesTextarea" name="review_notes" rows="4"
                            placeholder="Enter any notes or feedback for this task..." class="form-control"></textarea>
                        <div class="form-text">
                            These notes will be visible to the employee.
                        </div>
                    </div>

                    <div class="modal-buttons">
                        <button type="button" class="btn-secondary" id="cancelReview">Cancel</button>
                        <button type="submit" class="btn-primary" id="submitReview">Submit Review</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>