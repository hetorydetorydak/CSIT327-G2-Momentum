{% load static %}
<main class="dashboard-main extra-padding">
    <div class="kpi-wrapper">
        <!-- KPI 1 -->
        <div class="dashboard-card kpi-card metric-black">
            <div class="card-header">
                <h3 class="card-title">Total Employees </h3>
                <img src="{% static 'images/employee-icon.png' %}" 
                class="card-icon">
            </div>
            <p class="card-metric-kpi card-metric success">{{ kpi_data.total_employees|default:0 }}</p>
            <p class="card-detail">Active employees tracked</p>
        </div>

        <!-- KPI 2 -->
        <div class="dashboard-card kpi-card metric-black">
            <div class="card-header">
                <h3 class="card-title">Avg Compliance </h3>
                <img src="{% static 'images/compliance-icon.png' %}"
                class="card-icon">
            </div>
            <p class="card-metric-kpi card-metric {% if kpi_data.avg_compliance >= 80 %}success{% else %}warning{% endif %}">
                {{ kpi_data.avg_compliance|default:0 }}%
            </p>
            <p class="card-detail">
                {% if kpi_data.avg_compliance >= 80 %}
                    Meeting targets
                {% else %}
                    Needs improvement
                {% endif %}
            </p>
        </div>

        <!-- KPI 3 -->
        <div class="dashboard-card kpi-card metric-black">
            <div class="card-header">
                <h3 class="card-title">Avg Attendance </h3>
                <img src="{% static 'images/attendance2-icon.png' %}"
                class="card-icon">
            </div>
            <p class="card-metric-kpi card-metric {% if kpi_data.avg_attendance >= 85 %}success{% else %}warning{% endif %}">
                {{ kpi_data.avg_attendance|default:0 }}%
            </p>
            <p class="card-detail">
                {% if kpi_data.avg_attendance >= 90 %}
                    Within target range
                {% else %}
                    Below target
                {% endif %}
            </p>
        </div>

        <!-- KPI 4 -->
        <div class="dashboard-card kpi-card metric-black">
            <div class="card-header">
                <h3 class="card-title">Total Backlogs </h3>
                <img src="{% static 'images/backlog-icon.png' %}"
                class="card-icon">
            </div>
            <p class="card-metric-kpi card-metric {% if kpi_data.total_backlogs <= 15 %}success{% else %}warning{% endif %}">
                {{ kpi_data.total_backlogs|default:0 }}
            </p>
            <p class="card-detail">
                {% if kpi_data.employees_needing_attention %}
                    {{ kpi_data.employees_needing_attention_count|default:0 }} employees need attention
                {% else %}
                    Manageable workload
                {% endif %}
            </p>
        </div>
    </div>

    <!-- Performance Cards Section -->
    <div class="performance-cards-section">
        <div class="section-header">
            <h2>Team Performance</h2>
            <p>Click on any employee card to view detailed performance metrics</p>
        </div>

        <div class="performance-cards-grid">
            {% for employee in team_performance %}
            <div class="performance-card" data-employee-id="{{ employee.employee_id }}">
                <div class="performance-card-header">
                    <div class="employee-avatar">
                        <img src="{% static 'images/profile-icon.png' %}"
                        alt="Employee Avatar">
                    </div>
                    <div class="employee-info">
                        <h3 class="employee-name">{{ employee.name }}</h3>
                        <p class="employee-position">{{ employee.position }}</p>
                    </div>
                    <div class="performance-badge {{ employee.status }}">
                        <span class="badge-text">
                            {% if employee.status == 'excellent' %} ★ Excellent
                            {% elif employee.status == 'good' %} ✓ Good
                            {% elif employee.status == 'needs_improvement' %} ⚠ Needs Improvement
                            {% else %} ▼ Poor
                            {% endif %}
                        </span>
                    </div>
                </div>

                <!-- Performance Gauge -->
                <div class="performance-gauge">
                    <div class="gauge-container">
                        <div class="gauge-background">
                            <div class="gauge-fill" data-score="{{ employee.performance_score|default:0 }}"></div>
                        </div>
                        <div class="gauge-center">
                            <span class="gauge-score">{{ employee.performance_score|default:0 }}</span>
                        </div>
                    </div>
                    <div class="gauge-labels">
                        <span>0</span>
                        <span>50</span>
                        <span>100</span>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="stat-item">
                        <span class="stat-label">Attendance</span>
                        <span class="stat-value {% if employee.attendance_rate >= 85 %}success{% else %}warning{% endif %}">
                            {{ employee.attendance_rate|default:0 }}%
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Compliance</span>
                        <span class="stat-value {% if employee.compliance_rate >= 80 %}success{% else %}warning{% endif %}">
                            {{ employee.compliance_rate|default:0 }}%
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Backlogs</span>
                        <span class="stat-value {% if employee.backlog_count <= 2 %}success{% else %}warning{% endif %}">
                            {{ employee.backlog_count|default:0 }}
                        </span>
                    </div>
                </div>

                <!-- Drilldown Button -->
                <button class="drilldown-btn" onclick="viewEmployeeDetails({{ employee.employee_id }})">
                    View Details
                    <img src="{% static 'images/drilldown-icon.png' %}"
                    alt="View" class="drilldown-icon">
                </button>
            </div>
            {% empty %}
            <div class="no-employees-message">
                <p>No team members found in your department.</p>
            </div>
            {% endfor %}
        </div>
    </div>

    {%include 'dashboard/employee_performance_modal.html' %}
    
    <div class="sub-kpi-wrapper">
        <div class="dashboard-card kpi-card metric-black">
            <h3 class="card-title">Department Performance </h3>
            <p class="card-detail">Compliance and attendance by department</p>
            <img src="{% static 'images/bar-chart-placeholder.png' %}"
            alt="Performance Chart" class="no-overflow-img">
        </div>

        <div class="dashboard-card kpi-card metric-black">
            <h3 class="card-title">Performance Distribution </h3>
            <p class="card-detail">Employee performance categories</p>
            <img src="{% static 'images/pie-chart-placeholder.png' %}"
            alt="Performance Chart" class="no-overflow-img">
        </div>
    </div>
</main>

<script src="{% static 'dashboard/js/task-assignment.js' %}"></script>